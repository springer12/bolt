{
  "rules": {
    ".validate": "newData.hasChildren()",
    "rooms": {
      "$key1": {
        ".validate": "newData.hasChildren(['name', 'creator'])",
        "name": {
          ".validate": "newData.isString()"
        },
        "creator": {
          ".validate": "newData.isString() && (auth != null && newData.val() == auth.uid)"
        },
        "members": {
          "$key2": {
            ".validate": "newData.hasChildren(['nickname', 'isBanned']) && auth != null && $key2 == auth.uid",
            "nickname": {
              ".validate": "newData.val().length > 0 && newData.val().length <= 16"
            },
            "isBanned": {
              ".validate": "newData.isBoolean()"
            },
            "$other": {
              ".validate": "false"
            },
            ".write": "data.val() == null"
          }
        },
        "posts": {
          "$key3": {
            ".validate": "newData.hasChildren(['from', 'message', 'created', 'modified']) && $key3.length == 20",
            "from": {
              ".validate": "newData.isString() && (auth != null && newData.val() == auth.uid)"
            },
            "message": {
              ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 140"
            },
            "$other": {
              ".validate": "false"
            },
            ".write": "data.val() == null && (newData.parent().parent().child('members').child(auth.uid).val() != null && !(newData.parent().parent().child('members').child(auth.uid).child('isBanned').val() == true))",
            "created": {
              ".validate": "newData.isNumber() && newData.val() == (data.val() == null ? now : data.val())"
            },
            "modified": {
              ".validate": "newData.isNumber() && newData.val() == now"
            }
          }
        },
        "$other": {
          ".validate": "false"
        },
        ".read": "data.child('members').child(auth.uid).val() != null && !(data.child('members').child(auth.uid).child('isBanned').val() == true)",
        ".write": "data.val() == null || auth != null && newData.child('creator').val() == auth.uid"
      }
    },
    "$other": {
      ".validate": "false"
    }
  }
}
